# 2025-09-25 テスト実行メモ

## コマンドログ
| コマンド | 結果 | 備考 |
|---|---|---|
| `npm run lint` | ✅ | eslint が src 配下の TS/TSX を全通過 |
| `npm run test` | ✅ | Vitest。`tests/unit/**` のみ実行するよう設定を固定 |
| `npm run test:e2e` | ✅ | Playwright 3/3 パス（History / Options / Performance 検証完了） |

## 実施内容メモ
- UI 側に `window.CleanLinkReady` / `body[data-ready="true"]` を発火する仕組みを追加し、Playwright 側で `waitForCleanLinkReady()` を導入。
- `blockExternal()` で `cleanlink.local` 以外の HTTP リクエストを遮断しつつ、`serveDist()` で dist 配下を配信。
- Performance シナリオは `resolveAssetContaining('rules')` でハッシュ付きバンドルを特定し、`module.cleanUrl ?? module.c` を利用して100リンク処理を計測。
- Options 画面の site rule セレクトに `aria-label` を付与し、Axe の critical 指摘を解消。

## 直近の成果物
- Playwright run: `npm run test:e2e` (3/3 PASS, 21.3s)
- スクリーンショット・トレース: `test-results/`（Git管理外、Gate T 添付用）
- 新規ヘルパー: `tests/e2e/utils.ts`（wait/block）, `tests/e2e/utils.asset.ts`（バンドル解決）

## 次アクション
1. Gate T issue に今回の成功ログ / トレース概要とスクリーンショット（必要箇所のみ）を添付。
2. Options/History の Axe moderate 指摘については別チケットで改善検討（本テストでは serious/critical 不可を担保）。
3. 定期的に dist/.vite/manifest.json の構造変化を監視し、`resolveAssetContaining()` のフォールバック条件を見直す。
